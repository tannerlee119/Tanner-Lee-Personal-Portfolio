<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gabooja Creator Studio - Architecture Documentation</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        :root {
            /* Shared Token Palette matches Next.js app */
            --primary: #764ba2;
            --primary-light: #a78bfa;
            --secondary: #667eea;
            --background: #f5f5f5;
            --foreground: #333333;
            --card-bg: #ffffff;
            --border: #e5e5e5;
            --heading-color: #667eea;
            --subheading-color: #764ba2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--foreground);
            background: var(--background);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
            color: white;
            padding: 40px 0;
            margin-bottom: 40px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        nav {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        nav h2 {
            margin-bottom: 15px;
            color: var(--heading-color);
        }

        nav ul {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }

        nav a {
            color: var(--foreground);
            text-decoration: none;
            padding: 8px 12px;
            display: block;
            border-radius: 4px;
            transition: all 0.3s;
        }

        nav a:hover {
            background: var(--primary);
            color: white;
        }

        .section {
            background: var(--card-bg);
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            color: var(--heading-color);
            margin-bottom: 15px;
            font-size: 2em;
            border-bottom: 3px solid var(--heading-color);
            padding-bottom: 10px;
        }

        .section h3 {
            color: var(--subheading-color);
            margin: 25px 0 15px 0;
            font-size: 1.5em;
        }

        .section p {
            margin-bottom: 15px;
        }

        .diagram-container {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            overflow-x: auto;
            border: 1px solid var(--border);
        }

        .mermaid {
            display: flex;
            justify-content: center;
            min-height: 200px;
        }

        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .tech-item {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid var(--secondary);
            border: 1px solid var(--border);
            border-left-width: 4px;
        }

        .tech-item h4 {
            color: var(--heading-color);
            margin-bottom: 8px;
        }

        .tech-item ul {
            list-style: none;
            padding-left: 10px;
        }

        .tech-item li {
            padding: 3px 0;
        }

        code {
            background: var(--border);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }

        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .overview-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--secondary);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .overview-card h3 {
            color: var(--heading-color);
            margin-bottom: 10px;
        }
    </style>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#764ba2',        /* Primary (Violet) */
                primaryTextColor: '#fff',
                primaryBorderColor: '#667eea',  /* Secondary (Blue) */
                lineColor: '#667eea',
                secondaryColor: '#667eea',
                tertiaryColor: '#f8fafc'        /* Slate-50 */
            }
        });
    </script>
</head>

<body>
    <header>
        <div class="container">
            <h1>Gabooja Creator Studio</h1>
            <p>Complete Architecture Documentation & System Design</p>
        </div>
    </header>

    <div class="container">
        <nav>
            <h2>üìë Table of Contents</h2>
            <ul>
                <li><a href="#overview">System Overview</a></li>
                <li><a href="#context">System Context (C4 L1)</a></li>
                <li><a href="#containers">Container Diagram (C4 L2)</a></li>
                <li><a href="#api-components">API Components (C4 L3)</a></li>
                <li><a href="#frontend-components">Frontend Components</a></li>
                <li><a href="#deployment">Deployment Architecture</a></li>
                <li><a href="#sequences">Sequence Diagrams</a></li>
                <li><a href="#data-model">Data Model (ERD)</a></li>
                <li><a href="#tech-stack">Technology Stack</a></li>
            </ul>
        </nav>

        <section id="overview" class="section">
            <h2>üèóÔ∏è System Overview</h2>
            <p>Gabooja Creator Studio (GCS) is a comprehensive creative platform that enables users to design, generate,
                and publish custom products using AI-powered tools. The system integrates with external services for AI
                generation, print fulfillment, and the main Gabooja platform.</p>

            <div class="overview-grid">
                <div class="overview-card">
                    <h3>üé® Creative Studio</h3>
                    <p>Next.js-powered frontend for design creation with AI tools, canvas editor, and asset management.
                    </p>
                </div>
                <div class="overview-card">
                    <h3>‚öôÔ∏è API Platform</h3>
                    <p>NestJS backend handling authentication, project management, catalog synchronization, and workflow
                        orchestration.</p>
                </div>
                <div class="overview-card">
                    <h3>ü§ñ Agent Worker</h3>
                    <p>Temporal-based worker system for AI operations including generation, upscaling, and background
                        removal.</p>
                </div>
                <div class="overview-card">
                    <h3>üì¶ Infrastructure</h3>
                    <p>PostgreSQL for data, Redis for caching, MinIO for object storage, and Temporal for workflow
                        management.</p>
                </div>
            </div>
        </section>

        <section id="context" class="section">
            <h2>üåç System Context (C4 Level 1)</h2>
            <p>This diagram shows how the Gabooja Creator Studio fits into its broader ecosystem, including actors,
                external systems, and infrastructure components.</p>

            <div class="diagram-container">
                <div class="mermaid">
                    flowchart LR
                    actorUser[User]
                    actorAdmin[Admin]

                    subgraph GCS[Gabooja Creator Studio]
                    CS[Creative Studio<br />Next.js]
                    API[API<br />NestJS]
                    ADMIN[Admin Dashboard<br />Next.js]
                    WORKER[Agent Worker]
                    end

                    User <--> CS
                        Admin <--> ADMIN
                            CS <--> API
                                ADMIN <--> API
                                    WORKER <--> API

                                        subgraph Infra[Infrastructure]
                                        PG[(PostgreSQL)]
                                        R[(Redis)]
                                        MINIO[(MinIO)]
                                        TEMPORAL[[Temporal]]
                                        end

                                        API <--> PG
                                            API <--> R
                                                API <--> MINIO
                                                    WORKER <--> TEMPORAL

                                                        subgraph External[External Systems]
                                                        GABOOJA[[Gabooja Platform]]
                                                        PRINTFUL[[Printful]]
                                                        REPLICATE[[Replicate AI / OpenAI]]
                                                        end

                                                        API <--> GABOOJA
                                                            API <--> PRINTFUL
                                                                WORKER <--> REPLICATE
                </div>
            </div>
        </section>

        <section id="containers" class="section">
            <h2>üì¶ Container Diagram (C4 Level 2)</h2>
            <p>A more detailed view showing the major containers/applications within the system and their interactions.
            </p>

            <div class="diagram-container">
                <div class="mermaid">
                    flowchart TB
                    subgraph Client[Client Layer]
                    BROWSER[Web Browser]
                    end

                    subgraph FE[Creative Studio Frontend]
                    NEXT[Next.js App Router]
                    STATE[Zustand +<br />TanStack Query]
                    CANVAS[Design Canvas<br />& AI Tools]
                    end

                    BROWSER --> NEXT
                    NEXT --> STATE
                    NEXT --> CANVAS

                    subgraph BE[API Backend - NestJS]
                    AUTH[Auth Module]
                    USERS[Users Module]
                    PROJECTS[Projects Module]
                    CATALOG[Catalog Module]
                    AGENT[Agent Module /<br />WorkflowEngine]
                    STORAGE[Storage Service]
                    UPLOADS[Uploads Module]
                    end

                    NEXT <--> BE

                        subgraph Workers[Agent Worker System]
                        W1[Temporal Worker]
                        end

                        AGENT <--> W1

                            subgraph Data[Data Stores]
                            DB[(PostgreSQL<br />Database)]
                            CACHE[(Redis<br />Cache)]
                            OBJ[(MinIO<br />Object Storage)]
                            end

                            USERS <--> DB
                                PROJECTS <--> DB
                                    CATALOG <--> DB
                                        AUTH <--> DB
                                            AGENT <--> CACHE
                                                STORAGE <--> OBJ

                                                    subgraph Ext[External Services]
                                                    PRINTFUL[[Printful API]]
                                                    GAB[[Gabooja API]]
                                                    AI[[Replicate/<br />OpenAI]]
                                                    TEMP[[Temporal<br />Cluster]]
                                                    end

                                                    CATALOG <--> PRINTFUL
                                                        USERS <--> GAB
                                                            W1 <--> AI
                                                                W1 <--> TEMP
                </div>
            </div>
        </section>

        <section id="api-components" class="section">
            <h2>‚öôÔ∏è API Components (C4 Level 3)</h2>
            <p>Detailed component view of the NestJS API showing internal services and their relationships.</p>

            <div class="diagram-container">
                <div class="mermaid">
                    flowchart LR
                    subgraph API[NestJS API Components]
                    AUTH[AuthService]
                    CATSVC[CatalogService]
                    WF[WorkflowEngine]
                    STOR[StorageService]
                    USERS[UsersService]
                    PROJ[ProjectsService]
                    UP[UploadsService]
                    end

                    AUTH --> USERS
                    PROJ --> STOR
                    UP --> STOR
                    CATSVC --> PRINTFUL[(Printful<br />Adapter)]
                    WF --> TEMPORAL[[Temporal]]
                    WF --> AI[[Replicate/<br />OpenAI]]

                    subgraph Data[Data Persistence Layer]
                    DB[(PostgreSQL<br />Entities)]
                    REDIS[(Redis<br />Cache)]
                    end

                    AUTH <--> DB
                        USERS <--> DB
                            PROJ <--> DB
                                CATSVC <--> DB
                                    WF <--> REDIS
                                        STOR <--> OBJ[(MinIO/S3)]
                </div>
            </div>
        </section>

        <section id="frontend-components" class="section">
            <h2>üé® Frontend Components</h2>
            <p>Component architecture of the Creative Studio frontend application.</p>

            <div class="diagram-container">
                <div class="mermaid">
                    flowchart TB
                    subgraph Frontend[Creative Studio Frontend]
                    PAGES[Page Components<br />Auth / Studio / Wizard<br />Editor / Asset Library]
                    CANVAS[Canvas System<br />+ AI Tools]
                    SDK[Gabooja SDK]
                    STATE[Zustand<br />Store Slices]
                    QUERY[TanStack Query<br />Cache Layer]
                    FORMS[React Hook Form<br />+ Zod Validation]
                    end

                    PAGES --> CANVAS
                    PAGES --> FORMS
                    PAGES --> QUERY
                    PAGES --> STATE
                    PAGES --> SDK
                    SDK <--> API[(HTTP API)]
                </div>
            </div>
        </section>

        <section id="deployment" class="section">
            <h2>üöÄ Deployment Architecture</h2>
            <p>Shows how the system components are deployed and connected in production.</p>

            <div class="diagram-container">
                <div class="mermaid">
                    flowchart LR
                    subgraph Edge[Edge Layer]
                    CDN[CDN]
                    end

                    subgraph Cluster[gabooja-mesh Cluster]
                    API[API Container]
                    CS[Creative Studio<br />Container]
                    ADMIN[Admin Dashboard<br />Container]
                    WORKER[Agent Worker<br />Container]
                    end

                    subgraph Managed[Managed/External Services]
                    PG[(PostgreSQL)]
                    RED[(Redis)]
                    MIN[(MinIO)]
                    TMP[[Temporal]]
                    end

                    CDN --> CS
                    CS --> API
                    ADMIN --> API
                    API --> PG
                    API --> RED
                    API --> MIN
                    WORKER --> TMP
                </div>
            </div>
        </section>

        <section id="sequences" class="section">
            <h2>üìã Sequence Diagrams</h2>
            <p>Key interaction flows within the system.</p>

            <h3>Authentication Flow</h3>
            <div class="diagram-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant U as User
                    participant FE as Frontend
                    participant API as API<br />(AuthController)
                    participant DB as PostgreSQL
                    participant G as Gabooja API
                    participant S as StorageService

                    U->>FE: Fill register form
                    FE->>API: POST /auth/register
                    API->>DB: Create user<br />(hash password)
                    API->>G: Create creator<br />(optional)
                    API->>S: Sync avatar<br />(optional)
                    API-->>FE: { user, accessToken }
                    FE->>FE: Set HTTP-only cookie<br />Init session
                    FE-->>U: Redirect /studio
                </div>
            </div>

            <h3>Project Wizard (Auto-save)</h3>
            <div class="diagram-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant U as User
                    participant FE as Frontend<br />(Wizard)
                    participant API as API<br />(Projects)
                    participant DB as PostgreSQL

                    U->>FE: Edit fields
                    FE->>API: PATCH /projects/:id<br />(debounced)
                    API->>DB: upsert(project)
                    API-->>FE: 200 OK
                    FE->>FE: Optimistic<br />UI update
                </div>
            </div>

            <h3>AI Design Session</h3>
            <div class="diagram-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant U as User
                    participant FE as Frontend
                    participant API as API<br />(Agent)
                    participant W as Agent Worker
                    participant AI as Replicate/<br />OpenAI
                    participant OBJ as MinIO

                    U->>FE: Start AI session
                    FE->>API: POST /agent/session
                    API->>W: Enqueue workflow<br />(Temporal/SSE)
                    W->>AI: Generate /<br />upscale /<br />bg-removal
                    AI-->>W: Artifacts
                    W->>OBJ: Save rendered<br />assets
                    API-->>FE: Stream progress<br />updates (SSE)
                    FE-->>U: Show results
                </div>
            </div>

            <h3>Printful Order Creation</h3>
            <div class="diagram-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant U as User
                    participant FE as Frontend
                    participant API as API<br />(Orders/Catalog)
                    participant PF as Printful

                    U->>FE: Submit campaign
                    FE->>API: POST /campaigns/:id/publish
                    API->>PF: Create/Sync products
                    PF-->>API: Product/Variant IDs
                    API-->>FE: Publish success
                </div>
            </div>
        </section>

        <section id="data-model" class="section">
            <h2>üíæ Entity Relationship Diagram</h2>
            <p>Core data model showing the main entities and their relationships.</p>

            <div class="diagram-container">
                <div class="mermaid">
                    erDiagram
                    USERS ||--o{ PROJECTS : owns
                    USERS ||--o{ SESSIONS : has
                    PROJECTS ||--o{ ASSETS : contains
                    PROJECTS ||--o{ CAMPAIGNS : publishes
                    CAMPAIGNS ||--o{ ORDERS : generates
                    CATALOGPRODUCT ||--o{ CATALOGVARIANT : has
                    CAMPAIGNS ||--o{ CAMPAIGNITEM : includes
                    CAMPAIGNITEM }o--|| CATALOGVARIANT : references
                    ASSETS }o--|| USERS : uploaded_by
                </div>
            </div>
        </section>

        <section id="tech-stack" class="section">
            <h2>üõ†Ô∏è Technology Stack</h2>
            <div class="tech-stack">
                <div class="tech-item">
                    <h4>Frontend</h4>
                    <ul>
                        <li>Next.js 15 (App Router)</li>
                        <li>React 19</li>
                        <li>TypeScript</li>
                        <li>Tailwind CSS</li>
                        <li>Zustand (State)</li>
                        <li>TanStack Query</li>
                        <li>React Hook Form + Zod</li>
                        <li>Storybook</li>
                    </ul>
                </div>
                <div class="tech-item">
                    <h4>Backend</h4>
                    <ul>
                        <li>NestJS</li>
                        <li>TypeScript</li>
                        <li>PostgreSQL</li>
                        <li>Redis</li>
                        <li>Temporal</li>
                        <li>MinIO (S3-compatible)</li>
                        <li>JWT Authentication</li>
                    </ul>
                </div>
                <div class="tech-item">
                    <h4>AI & External</h4>
                    <ul>
                        <li>Replicate AI</li>
                        <li>OpenAI API</li>
                        <li>Printful API</li>
                        <li>Gabooja Platform API</li>
                    </ul>
                </div>
                <div class="tech-item">
                    <h4>DevOps & Tools</h4>
                    <ul>
                        <li>Turborepo</li>
                        <li>Docker</li>
                        <li>gabooja-mesh (cluster)</li>
                        <li>CDN</li>
                        <li>GitHub Actions</li>
                    </ul>
                </div>
            </div>
        </section>
    </div>
</body>

</html>